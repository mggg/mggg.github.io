{% assign work = include.work %}
{% if page.key == 'civic-tech' %}
  {% assign link_url = work.url %}
  {% assign is_external = false %}
  {% assign open_new_tab = false %}
{% else %}
  {% assign link_url = work.href | default: work.url %}
  {% if link_url contains 'http://' or link_url contains 'https://' %}
    {% assign is_external = true %}
  {% else %}
    {% assign is_external = false %}
  {% endif %}
  {% assign open_new_tab = is_external %}
{% endif %}
<li class="card">
  {% assign show_image = false %}
  {% if work.featured and work.image %}
    {% assign show_image = true %}
  {% elsif work.categories contains "basics" and work.image %}
    {% assign show_image = true %}
  {% elsif work.categories contains "civic-tech" and work.image %}
    {% assign show_image = true %}
  {% endif %}
  {% if show_image %}
  <a
    class="card__image-link"
    href="{{ link_url }}"
    {% if open_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
  >
    {% assign image_focus = work.image_focus %}
    {% if image_focus %}
    <img
      class="card__image"
      src="{{ work.image | relative_url }}"
      alt="{{ work.image_caption }}"
      style="object-position: {{ image_focus }};"
    />
    {% else %}
    <img
      class="card__image"
      src="{{ work.image | relative_url }}"
      alt="{{ work.image_caption }}"
    />
    {% endif %}
  </a>
  {% endif %}

  <div class="card__content">
    <h3 class="card__title card__title--featured">
      {% if work.no_title_link %}
        {% if work.short_title %}{{ work.short_title }}{% else %}{{ work.title }}{% endif %}
      {% else %}
        <a
          href="{{ link_url }}"
          {% if open_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
          >{% if work.short_title %}{{ work.short_title }}{% else %}{{
            work.title
          }}{% endif %}</a
        >
      {% endif %}
    </h3>
    {% if work.authors %}
    <div class="post__metadata">
      {% assign hide_date = false %}
      {% if work.categories contains "basics" %}
        {% assign hide_date = true %}
      {% endif %}
      {% if work.categories contains "research" %}
        {% assign hide_date = true %}
      {% endif %}
      {% if work.categories contains "civic-tech" %}
        {% assign hide_date = true %}
      {% endif %}
      {% if work.categories contains "reports" %}
        {% assign hide_date = true %}
      {% endif %}
      <div class="post__authors{% if hide_date %} post__authors--no-date{% endif %}">{{ work.authors }}</div>
      {% unless hide_date %}
      <div class="post__date">{{ work.date | date_to_long_string }}</div>
      {% endunless %}
    </div>
    {% endif %}
    {% if work.description %}
    {{
      work.description
      | markdownify
      | replace: "<p>", '<p class="card__teaser">'
    }}
    {% elsif work.excerpt %}
    {{
      work.excerpt
      | replace: "<p>", '<p class="card__teaser">'
    }}
    {% endif %}
    {% if work.publication %}
    <div class="card__publication">
      {{ work.publication }}{% if work.publication_date %},
      {{ work.publication_date | date: "%B %Y" }}. {% endif %}
    </div>
    {% elsif work.publication_date %}
    <div class="card__publication">
      {{ work.publication_date | date: "%B %Y" }}.
    </div>
    {% endif %}
  </div>
</li>
